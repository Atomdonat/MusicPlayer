

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>code_backend.spotify_web_api &mdash; MusicPlayer 1.15.7 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=bb5c4468"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            MusicPlayer
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">MusicPlayer</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MusicPlayer</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">code_backend.spotify_web_api</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for code_backend.spotify_web_api</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of the Spotify Web API to fit project purpose</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">types</span><span class="w"> </span><span class="kn">import</span> <span class="n">NoneType</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.common</span><span class="w"> </span><span class="kn">import</span> <span class="n">WebDriverException</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">code_backend.shared_config</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">code_backend.secondary_methods</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">check_limits</span><span class="p">,</span> <span class="n">check_token_expired</span><span class="p">,</span> <span class="n">value_from_dict</span><span class="p">,</span>
    <span class="n">update_env_key</span><span class="p">,</span> <span class="n">image_from_url</span><span class="p">,</span> <span class="n">print_debug</span><span class="p">,</span>
    <span class="n">absolute_path</span><span class="p">,</span> <span class="n">remove_key_recursively</span><span class="p">,</span> <span class="n">json_to_file</span><span class="p">,</span>
    <span class="n">check_spotify_id</span><span class="p">,</span> <span class="n">check_spotify_ids</span><span class="p">,</span> <span class="n">check_spotify_uri</span><span class="p">,</span> <span class="n">check_spotify_uris</span><span class="p">,</span>
    <span class="n">get_invalid_spotify_ids</span><span class="p">,</span> <span class="n">get_invalid_spotify_uris</span><span class="p">,</span> <span class="n">check_spotify_user_ids</span><span class="p">,</span> <span class="n">uri_to_id</span><span class="p">,</span> <span class="n">url_to_uri</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">code_backend.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">HttpException</span><span class="p">,</span> <span class="n">RequestException</span><span class="p">,</span> <span class="n">CustomException</span><span class="p">,</span> <span class="n">InputException</span><span class="p">,</span>
    <span class="n">SpotifyIdException</span><span class="p">,</span> <span class="n">SpotifyUriException</span><span class="p">,</span> <span class="n">LimitException</span>
<span class="p">)</span>


<span class="c1"># Note: Curl-to-... Converter:</span>
<span class="c1">#  https://curlconverter.com/python/</span>

<span class="c1"># Note: some methods can still have bugs depending on usage</span>


<div class="viewcode-block" id="request_regular_token">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.request_regular_token">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">request_regular_token</span><span class="p">(</span><span class="n">use_credentials</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">force_new_token</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Request an access token, using the Authorization Code Flow tutorial and cache it in the .env file. If Spotify credentials are found in .env file, the script runs the login automated. Else User interaction is needed.</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/tutorials/code-flow</span>

<span class="sd">    **Note:** using credentials can lead to some API requests returning the http error code 500</span>

<span class="sd">    :param use_credentials: True: use credentials inside .env file to be logged in automatically; False: log-in manually</span>
<span class="sd">    :param force_new_token: Whether to force a new access token (e.g. if env key has not been set yet)</span>
<span class="sd">    :return: caches token in .env</span>
<span class="sd">    :raises CustomException: If Exception occurs</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">force_new_token</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">force_new_token</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">force_new_token</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;REGULAR_TOKEN&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">refresh_access_token</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">use_credentials</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">use_credentials</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">use_credentials</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SPOTIFY_USERNAME</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">SPOTIFY_PASSWORD</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">CustomException</span><span class="p">(</span>
            <span class="n">error_message</span><span class="o">=</span><span class="s2">&quot;No credentials provided&quot;</span><span class="p">,</span>
            <span class="n">more_infos</span><span class="o">=</span><span class="s2">&quot;Check your credentials in .env (if stored there)&quot;</span>
        <span class="p">)</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_random_string</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a random string of fixed length.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">length</span><span class="p">))</span>

    <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">():</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">generate_random_string</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>

        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;response_type&#39;</span><span class="p">:</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
            <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="n">CLIENT_ID</span><span class="p">,</span>
            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="n">SCOPES</span><span class="p">,</span>
            <span class="s1">&#39;redirect_uri&#39;</span><span class="p">:</span> <span class="n">REDIRECT_URI</span><span class="p">,</span>
            <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="n">state</span>
        <span class="p">}</span>

        <span class="n">auth_url</span> <span class="o">=</span> <span class="s1">&#39;https://accounts.spotify.com/authorize?&#39;</span> <span class="o">+</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query_params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">auth_url</span><span class="p">)</span>

    <span class="c1"># @app.route(&#39;/&#39;)</span>
    <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/callback&#39;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">callback</span><span class="p">():</span>
        <span class="c1"># Extract the &#39;code&#39; and &#39;state&#39; parameters from the URL</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">error_query</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;state_mismatch&#39;</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/#</span><span class="si">{</span><span class="n">error_query</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Prepare the request for token exchange</span>
        <span class="n">token_url</span> <span class="o">=</span> <span class="s1">&#39;https://accounts.spotify.com/api/token&#39;</span>
        <span class="n">auth_header</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CLIENT_ID</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">CLIENT_SECRET</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Basic </span><span class="si">{</span><span class="n">auth_header</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span>
            <span class="s1">&#39;redirect_uri&#39;</span><span class="p">:</span> <span class="n">REDIRECT_URI</span><span class="p">,</span>
            <span class="s1">&#39;grant_type&#39;</span><span class="p">:</span> <span class="s1">&#39;authorization_code&#39;</span>
        <span class="p">}</span>

        <span class="c1"># Exchange the authorization code for an access token</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">token_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_flask_app</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run Flask app in a separate thread.&quot;&quot;&quot;</span>
        <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_reloader</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">automated_request_handling</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Request a new Access Token from spotify</span>

<span class="sd">        :return:</span>
<span class="sd">        :raises CustomException: If Exception occurs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wait_timeout</span> <span class="o">=</span> <span class="mi">120</span>  <span class="c1"># seconds</span>

        <span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">implicitly_wait</span><span class="p">(</span><span class="n">WAIT_TIME</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://localhost:8080/login&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">WebDriverException</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CustomException</span><span class="p">(</span><span class="n">error_message</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">more_infos</span><span class="o">=</span><span class="s2">&quot;Exception occurred while starting selenium on &#39;http://localhost:8080/login&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">use_credentials</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;login-username&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">SPOTIFY_USERNAME</span><span class="p">)</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;login-password&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">SPOTIFY_PASSWORD</span><span class="p">)</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;login-button&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">NoSuchElementException</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="c1"># can occur if f.e. requested too many access tokens in a short period of time =&gt; Spotify requests 2FA on login (no password element)</span>
                <span class="k">raise</span> <span class="n">CustomException</span><span class="p">(</span>
                    <span class="n">error_message</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>
                    <span class="n">more_infos</span><span class="o">=</span><span class="s2">&quot;Exception occurred because Selenium could not find all elements &#39;login-username&#39;, &#39;login-password&#39;, &#39;login-button&#39;&quot;</span>
                <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># else: login manually while script waits up to 2 min</span>
            <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">wait_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">current_url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http://localhost:8080/callback?code=&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">raw_data_tab</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s1">&#39;rawdata-tab&#39;</span><span class="p">)</span>
            <span class="n">raw_data_tab</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

            <span class="c1"># Allow time for content to load</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Locate the content within the &quot;Raw Data&quot; panel</span>
            <span class="n">token_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s1">&#39;pre&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">relevant_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;access_token&#39;</span><span class="p">:</span> <span class="n">token_data</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">],</span>
                <span class="s1">&#39;token_type&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer&#39;</span><span class="p">,</span>
                <span class="s1">&#39;expires&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="n">token_data</span><span class="p">[</span><span class="s1">&#39;expires_in&#39;</span><span class="p">]</span>
            <span class="p">}</span>
            <span class="n">update_env_key</span><span class="p">(</span><span class="s2">&quot;REGULAR_TOKEN&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">relevant_data</span><span class="p">))</span>
            <span class="n">update_env_key</span><span class="p">(</span><span class="s2">&quot;REFRESH_TOKEN&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="n">token_data</span><span class="p">[</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">]}))</span>
            <span class="n">update_env_key</span><span class="p">(</span><span class="s2">&quot;AUTHORIZED_SCOPES&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="n">token_data</span><span class="p">[</span><span class="s1">&#39;scope&#39;</span><span class="p">]}))</span>

        <span class="k">except</span> <span class="n">TimeoutException</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">CustomException</span><span class="p">(</span>
                <span class="n">error_message</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>
                <span class="n">more_infos</span><span class="o">=</span><span class="s2">&quot;Either the credentials are incorrect or the user has not logged in. </span><span class="se">\n</span><span class="s2">  - Check your credentials in .env (if stored there)</span><span class="se">\n</span><span class="s2">  - if script aborted before finishing to enter credentials increment wait_timeout&quot;</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">CustomException</span><span class="p">(</span>
                <span class="n">error_message</span><span class="o">=</span><span class="n">error</span>
            <span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Start Flask app in a separate thread</span>
    <span class="n">flask_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run_flask_app</span><span class="p">)</span>
    <span class="n">flask_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">flask_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="c1"># Give Flask a moment to start</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Run Selenium in the main thread</span>
    <span class="n">automated_request_handling</span><span class="p">()</span></div>



<div class="viewcode-block" id="refresh_access_token">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.refresh_access_token">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">refresh_access_token</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A refresh token is a security credential that allows client applications to obtain new access tokens without requiring users to reauthorize the application.</span>
<span class="sd">    Access tokens are intentionally configured to have a limited lifespan (1 hour), at the end of which, new tokens can be obtained by providing the original refresh token acquired during the authorization token request response.</span>
<span class="sd">    Official Documentation: https://developer.spotify.com/documentation/web-api/tutorials/refreshing-tokens</span>

<span class="sd">    :return: update REGULAR_TOKEN (and AUTHORIZED_SCOPES) in .env</span>
<span class="sd">    :raises HttpException: if request response code is not good</span>
<span class="sd">    :raises CustomException: If Exception occurs</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check Scope equality with sets</span>
    <span class="n">config_scope_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">SCOPES</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span>
    <span class="n">env_scope_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;AUTHORIZED_SCOPES&#39;</span><span class="p">))[</span><span class="s2">&quot;scope&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">config_scope_set</span> <span class="o">!=</span> <span class="n">env_scope_set</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">CORANGE</span> <span class="o">+</span> <span class="s2">&quot;Scope changed since the last authorization of an access token.</span><span class="se">\n</span><span class="s2">Reauthorizing access token...&quot;</span> <span class="o">+</span> <span class="n">TEXTCOLOR</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">request_regular_token</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;REFRESH_TOKEN&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">CORANGE</span> <span class="o">+</span> <span class="s2">&quot;Refresh token was not obtained.</span><span class="se">\n</span><span class="s2">Reauthorizing access token...&quot;</span> <span class="o">+</span> <span class="n">TEXTCOLOR</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">request_regular_token</span><span class="p">()</span>

    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://accounts.spotify.com/api/token&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Basic </span><span class="si">{</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">CLIENT_ID</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">CLIENT_SECRET</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">}</span>
    <span class="n">form</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;grant_type&#39;</span><span class="p">:</span> <span class="s1">&#39;refresh_token&#39;</span><span class="p">,</span>
        <span class="s1">&#39;refresh_token&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;REFRESH_TOKEN&quot;</span><span class="p">))[</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">form</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Error handling according to Spotify&#39;s Error Codes</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">204</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HttpException</span><span class="p">(</span>
                <span class="n">error_code</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                <span class="n">request_query</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">form</span><span class="p">),</span>
                <span class="n">response_text</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">CustomException</span><span class="p">(</span><span class="n">error_message</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">more_infos</span><span class="o">=</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CORANGE</span><span class="si">}</span><span class="s2">HttpException() raised JSONDecodeError: </span><span class="si">{</span><span class="n">TEXTCOLOR</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CORANGE</span><span class="si">}</span><span class="s2">Response Code:</span><span class="si">{</span><span class="n">TEXTCOLOR</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CORANGE</span><span class="si">}</span><span class="s2">Response as Bytes:</span><span class="si">{</span><span class="n">TEXTCOLOR</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CORANGE</span><span class="si">}</span><span class="s2">Response as String:</span><span class="si">{</span><span class="n">TEXTCOLOR</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">refresh_token_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

            <span class="c1"># update access token</span>
            <span class="n">new_regular_token</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;access_token&quot;</span><span class="p">:</span> <span class="n">refresh_token_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;access_token&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;token_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
                <span class="s2">&quot;expires&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="n">refresh_token_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;expires_in&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">update_env_key</span><span class="p">(</span><span class="s1">&#39;REGULAR_TOKEN&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">new_regular_token</span><span class="p">))</span>

            <span class="c1"># only update if new Refresh Token is part of Response, When a refresh token is not returned, continue using the existing token</span>
            <span class="k">if</span> <span class="n">refresh_token_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">new_refresh_token</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="n">refresh_token_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)}</span>
                <span class="n">update_env_key</span><span class="p">(</span><span class="s1">&#39;REFRESH_TOKEN&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">new_refresh_token</span><span class="p">))</span>

            <span class="c1"># for debug</span>
            <span class="c1"># return refresh_token_data</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CustomException</span><span class="p">(</span><span class="n">error_message</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">more_infos</span><span class="o">=</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Exception occurred while refreshing access token</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CORANGE</span><span class="si">}</span><span class="s2">Response Length:</span><span class="si">{</span><span class="n">TEXTCOLOR</span><span class="si">}{</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CORANGE</span><span class="si">}</span><span class="s2">Response Content:</span><span class="se">\n</span><span class="si">{</span><span class="n">TEXTCOLOR</span><span class="si">}{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">CRED</span><span class="si">}{</span><span class="n">error</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">TEXTCOLOR</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">))</span></div>



<div class="viewcode-block" id="request_extended_token">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.request_extended_token">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">request_extended_token</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Using https://www.chosic.com/spotify-playlist-analyzer/ to request temporary extended-token, that can be used to request Web API Data. After 1 hour a new token needs to be requested.</span>
<span class="sd">    This implementation extracts the Spotify Web API token after one default request out of the local Storage value `plAnalyzerToken` (hopefully not violating Terms of Services).</span>

<span class="sd">    :raises CustomException: If Exception occurs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">implicitly_wait</span><span class="p">(</span><span class="n">WAIT_TIME</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://www.chosic.com/spotify-playlist-analyzer/&quot;</span><span class="p">)</span>

        <span class="n">elem</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">)</span>
        <span class="n">elem</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">elem</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s2">&quot;https://open.spotify.com/playlist/3cEYpjA9oz9GiPac4AsH4n&quot;</span><span class="p">)</span>
        <span class="n">elem</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">RETURN</span><span class="p">)</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">WAIT_TIME</span><span class="p">)</span>

        <span class="c1"># extracting Token from Driver Storage</span>
        <span class="n">token_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;return localStorage;&quot;</span><span class="p">)[</span><span class="s2">&quot;plAnalyzerToken&quot;</span><span class="p">])</span>
        <span class="n">relevant_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;access_token&#39;</span><span class="p">:</span> <span class="n">token_data</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">],</span>
            <span class="s1">&#39;token_type&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer&#39;</span><span class="p">,</span>
            <span class="s1">&#39;expires&#39;</span><span class="p">:</span> <span class="n">token_data</span><span class="p">[</span><span class="s1">&#39;expires&#39;</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="n">update_env_key</span><span class="p">(</span><span class="s2">&quot;EXTENDED_TOKEN&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">relevant_data</span><span class="p">))</span>

        <span class="n">driver</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">raise</span> <span class="n">CustomException</span><span class="p">(</span>
            <span class="n">error_message</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>
            <span class="n">more_infos</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Exception occurred while requesting temporary extended token&quot;</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="api_request_data">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.api_request_data">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">request_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="s2">&quot;PUT&quot;</span><span class="p">],</span>
        <span class="n">json_data</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">overwrite_header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">json_as_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transferring data from or to a server using Curl commands via [requests](https://docs.python-requests.org/en/latest/index.html). Currently supported HTTP regular_api_methods are `GET`, `POST`, `PUT` and `DELETE` (This implementation is designed for Spotify API requests)</span>

<span class="sd">    :param url: url to curl from/to</span>
<span class="sd">    :param request_type: HTTP request method</span>
<span class="sd">    :param json_data: JSON data to send</span>
<span class="sd">    :param overwrite_header: Specific headers to overwrite default headers</span>
<span class="sd">    :param json_as_data: True: data=json_data, False: json=json_data (Whether to send json_data as data or json)</span>
<span class="sd">    :return: JSON data fetched from Spotify API</span>
<span class="sd">    :raises RequestException: if Exception occurs while using requests</span>
<span class="sd">    :raises HttpException: if request response code is not good</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    :raises CustomException: If Exception occurs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="s2">&quot;URLs (https://example.com)&quot;</span><span class="p">,</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">request_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">request_type</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="s2">&quot;PUT&quot;</span><span class="p">],</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">json_data</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="s2">&quot;(depend on specific request)&quot;</span><span class="p">,</span> <span class="n">valid_types</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overwrite_header</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">overwrite_header</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;(depend on specific request)&quot;</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">json_as_data</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">json_as_data</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">check_token_expired</span><span class="p">(</span><span class="n">extended_token</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">refresh_access_token</span><span class="p">()</span>

    <span class="c1"># HTTP Headers needed for Spotify API requests</span>
    <span class="k">if</span> <span class="n">overwrite_header</span><span class="p">:</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">overwrite_header</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># If the extended Token is needed, this gets overwritten (case above)</span>
            <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;REGULAR_TOKEN&quot;</span><span class="p">))[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">json_data</span><span class="p">:</span>
            <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>

    <span class="c1"># print(headers)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">match</span> <span class="n">request_type</span><span class="p">:</span>
            <span class="c1"># Note: there can be errors depending on whether &#39;json=&#39; or &#39;data=&#39; was used, modify cases if needed</span>
            <span class="k">case</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">json_data</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                    <span class="n">json</span><span class="o">=</span><span class="n">json_data</span>
                <span class="p">)</span>
            <span class="k">case</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">json_data</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                    <span class="n">json</span><span class="o">=</span><span class="n">json_data</span>
                <span class="p">)</span>

            <span class="k">case</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">json_data</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                    <span class="n">json</span><span class="o">=</span><span class="n">json_data</span>
                <span class="p">)</span>

            <span class="k">case</span> <span class="s2">&quot;PUT&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">json_as_data</span><span class="p">:</span>
                    <span class="n">query</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json_data</span><span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
                        <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                        <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">json_data</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">query</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">json_data</span><span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
                        <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                        <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                        <span class="n">json</span><span class="o">=</span><span class="n">json_data</span>
                    <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">RequestException</span><span class="p">(</span>
            <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>
            <span class="n">request_query</span><span class="o">=</span><span class="n">query</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">204</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HttpException</span><span class="p">(</span>
                <span class="n">error_code</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                <span class="n">request_query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
                <span class="n">response_text</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">CORANGE</span> <span class="o">+</span> <span class="s2">&quot;HttpException() JSONDecodeError:&quot;</span> <span class="o">+</span> <span class="n">TEXTCOLOR</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CORANGE</span><span class="si">}</span><span class="s2">Response Code:</span><span class="si">{</span><span class="n">TEXTCOLOR</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CORANGE</span><span class="si">}</span><span class="s2">Response as Bytes:</span><span class="si">{</span><span class="n">TEXTCOLOR</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CORANGE</span><span class="si">}</span><span class="s2">Response as String:</span><span class="si">{</span><span class="n">TEXTCOLOR</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Debugging:</span>
    <span class="c1"># with open(absolute_path(SPOTIFY_HTTP_ERRORS_PATH), &#39;r&#39;) as j_file:</span>
    <span class="c1">#     spotify_error_codes = json.load(j_file)</span>
    <span class="c1">#</span>
    <span class="c1"># prepared_query = query.prepare()</span>
    <span class="c1">#</span>
    <span class="c1"># print_debug(</span>
    <span class="c1">#     f&quot;{CORANGE}Request returned Code:{TEXTCOLOR} {response.status_code} - {spotify_error_codes[str(response.status_code)][&quot;name&quot;]}\n&quot;</span>
    <span class="c1">#     f&quot;{CORANGE}Response as Bytes:{TEXTCOLOR} {response.content[:1000]+b&#39;...&#39;}\n&quot;</span>
    <span class="c1">#     f&quot;{CORANGE}Response as String:{TEXTCOLOR} {response.text[:1000]+&quot;...&quot;}\n\n&quot;</span>
    <span class="c1">#     f&quot;{CORANGE}Responsible Query:\n&quot;</span>
    <span class="c1">#     f&quot;{CORANGE}-----------START-----------\n&quot;</span>
    <span class="c1">#     f&quot;{prepared_query.method} {prepared_query.url}\n&quot;</span>
    <span class="c1">#     + &quot;\n&quot;.join(f&quot;{key}: {value}&quot; for key, value in prepared_query.headers.items()) + &quot;\n&quot;</span>
    <span class="c1">#     &quot;Request Body:\n&quot;</span>
    <span class="c1">#     f&quot;{prepared_query.body if prepared_query.body else &#39;\&#39;---\&#39;&#39;}\n&quot;</span>
    <span class="c1">#     f&quot;------------END------------{TEXTCOLOR}&quot;</span>
    <span class="c1"># )</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CustomException</span><span class="p">(</span>
                    <span class="n">error_message</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>
                    <span class="n">more_infos</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CORANGE</span><span class="si">}</span><span class="s2">Response Length:</span><span class="si">{</span><span class="n">TEXTCOLOR</span><span class="si">}{</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">CORANGE</span><span class="si">}</span><span class="s2">Response Content:</span><span class="se">\n</span><span class="si">{</span><span class="n">TEXTCOLOR</span><span class="si">}{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span></div>



<span class="c1"># &lt;-- Begin Spotify Album Methods --&gt;</span>
<div class="viewcode-block" id="get_album">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_album">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_album</span><span class="p">(</span><span class="n">album_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ignore_market</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Spotify catalog information for a single album.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-an-album</span>

<span class="sd">    :param album_id: The Spotify ID of the album.</span>
<span class="sd">    :param ignore_market: Whether to ignore market.</span>
<span class="sd">    :return: Dict containing Spotify Albums, in the form of {album_uri: album}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">album_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">album_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;album&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ignore_market</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">ignore_market</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/albums/</span><span class="si">{</span><span class="n">album_id</span><span class="si">}{</span><span class="sa">f</span><span class="s2">&quot;?market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ignore_market</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">response</span><span class="p">}</span></div>


<span class="c1">#mps: 2</span>
<div class="viewcode-block" id="get_several_albums">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_several_albums">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_several_albums</span><span class="p">(</span><span class="n">album_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">ignore_market</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Spotify catalog information for multiple albums identified by their Spotify IDs.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-multiple-albums</span>

<span class="sd">    :param album_ids: A comma-separated list of the Spotify IDs for the albums.</span>
<span class="sd">    :param ignore_market: Whether to ignore market.</span>
<span class="sd">    :return: Dict containing Spotify Albums, in the form of {album_uri: album}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_ids</span><span class="p">(</span><span class="n">spotify_ids</span><span class="o">=</span><span class="n">album_ids</span><span class="p">):</span>
        <span class="n">invalid_albums</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_invalid_spotify_ids</span><span class="p">(</span><span class="n">spotify_ids</span><span class="o">=</span><span class="n">album_ids</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">invalid_albums</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;album&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ignore_market</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">ignore_market</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="n">albums</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">current_chunk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">album_ids</span><span class="p">),</span> <span class="mi">20</span><span class="p">):</span>
        <span class="n">encoded_chunk</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">album_ids</span><span class="p">[</span><span class="n">current_chunk</span><span class="p">:</span> <span class="n">current_chunk</span> <span class="o">+</span> <span class="mi">20</span><span class="p">]))</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/albums?ids=</span><span class="si">{</span><span class="n">encoded_chunk</span><span class="si">}{</span><span class="sa">f</span><span class="s2">&quot;&amp;market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ignore_market</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;albums&quot;</span><span class="p">]}</span>
        <span class="n">albums</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">albums</span></div>



<div class="viewcode-block" id="get_album_tracks">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_album_tracks">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_album_tracks</span><span class="p">(</span><span class="n">album_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">get_duration</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ignore_market</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Spotify catalog information about an album’s tracks. Optional parameters can be used to limit the number of tracks returned.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-an-albums-tracks</span>

<span class="sd">    :param album_id: The Spotify ID of the album.</span>
<span class="sd">    :param get_duration: If to get the Playlist duration in seconds. Default: False.</span>
<span class="sd">    :param ignore_market: Whether to ignore market.</span>
<span class="sd">    :return: Dict containing Spotify Tracks, in the form of {track_uri: track} (and optional the duration as second param)</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">album_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">album_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;album&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">get_duration</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">get_duration</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ignore_market</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">ignore_market</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="n">track_dicts</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Get first (up to) 50 tracks</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/albums/</span><span class="si">{</span><span class="n">album_id</span><span class="si">}</span><span class="s2">/tracks?</span><span class="si">{</span><span class="sa">f</span><span class="s2">&quot;market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ignore_market</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2">limit=50&amp;offset=0&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
    <span class="n">track_dicts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="c1"># If there are more than 50 albums:</span>
    <span class="n">total_albums</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span>
    <span class="n">current_offset</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="k">while</span> <span class="n">current_offset</span> <span class="o">&lt;</span> <span class="n">total_albums</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/albums/</span><span class="si">{</span><span class="n">album_id</span><span class="si">}</span><span class="s2">/tracks?market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&amp;limit=50&amp;offset=</span><span class="si">{</span><span class="n">current_offset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
        <span class="n">track_dicts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

        <span class="n">current_offset</span> <span class="o">+=</span> <span class="mi">50</span>

    <span class="k">if</span> <span class="n">get_duration</span><span class="p">:</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">current_track</span><span class="p">[</span><span class="s2">&quot;duration_ms&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">current_track</span> <span class="ow">in</span> <span class="n">track_dicts</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">track_dicts</span><span class="p">,</span> <span class="n">duration</span>

    <span class="k">return</span> <span class="n">track_dicts</span></div>



<div class="viewcode-block" id="get_users_saved_albums">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_users_saved_albums">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_users_saved_albums</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a list of the albums saved in the current Spotify user&#39;s &#39;Your Music&#39; library.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-library-read</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-users-saved-albums</span>

<span class="sd">    :return: Dict containing Saved Spotify Albums, in the form of {album_uri: album}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">albums</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Get first (up to) 50 albums</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/albums?limit=50&amp;offset=0&amp;market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;album&quot;</span><span class="p">][</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;album&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
    <span class="n">albums</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="c1"># If there are more than 50 albums:</span>
    <span class="n">total_albums</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span>
    <span class="n">current_offset</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="k">while</span> <span class="n">current_offset</span> <span class="o">&lt;</span> <span class="n">total_albums</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/albums?limit=50&amp;offset=</span><span class="si">{</span><span class="n">current_offset</span><span class="si">}</span><span class="s2">&amp;market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;album&quot;</span><span class="p">][</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;album&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
        <span class="n">albums</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

        <span class="n">current_offset</span> <span class="o">+=</span> <span class="mi">50</span>

    <span class="k">return</span> <span class="n">albums</span></div>



<div class="viewcode-block" id="check_users_saved_albums">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.check_users_saved_albums">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">check_users_saved_albums</span><span class="p">(</span><span class="n">album_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if one or more albums is already saved in the current Spotify user&#39;s &#39;Your Music&#39; library.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-library-read</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/check-users-saved-albums</span>

<span class="sd">    :param album_ids: A comma-separated list of the Spotify IDs for the albums. Maximum: 20 IDs.</span>
<span class="sd">    :return: Dict containing if Spotify Albums are saved by User, in the form of {album_uri: exists?}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_ids</span><span class="p">(</span><span class="n">spotify_ids</span><span class="o">=</span><span class="n">album_ids</span><span class="p">):</span>
        <span class="n">invalid_albums</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_invalid_spotify_ids</span><span class="p">(</span><span class="n">spotify_ids</span><span class="o">=</span><span class="n">album_ids</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">invalid_albums</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;album&quot;</span><span class="p">)</span>

    <span class="n">albums</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">current_chunk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">album_ids</span><span class="p">),</span> <span class="mi">50</span><span class="p">):</span>
        <span class="n">encoded_chunk</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">album_ids</span><span class="p">[</span><span class="n">current_chunk</span><span class="p">:</span> <span class="n">current_chunk</span> <span class="o">+</span> <span class="mi">50</span><span class="p">]))</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/albums/contains?ids=</span><span class="si">{</span><span class="n">encoded_chunk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">uri</span><span class="p">,</span> <span class="n">existence</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">album_ids</span><span class="p">[</span><span class="n">current_chunk</span><span class="p">:</span> <span class="n">current_chunk</span> <span class="o">+</span> <span class="mi">50</span><span class="p">],</span> <span class="n">response</span><span class="p">):</span>
            <span class="n">albums</span><span class="p">[</span><span class="n">uri</span><span class="p">]</span> <span class="o">=</span> <span class="n">existence</span>

    <span class="k">return</span> <span class="n">albums</span></div>



<span class="c1"># &lt;-- Begin Spotify Artist Methods --&gt;</span>
<div class="viewcode-block" id="get_artist">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_artist">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_artist</span><span class="p">(</span><span class="n">artist_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Spotify catalog information for a single artist identified by their unique Spotify ID.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-an-artist</span>

<span class="sd">    :param artist_id: The Spotify ID of the artist.</span>
<span class="sd">    :return: Dict containing Spotify Artists, in the form of {artist_uri: artist}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">artist_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">artist_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;artist&quot;</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/artists/</span><span class="si">{</span><span class="n">artist_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">response</span><span class="p">}</span></div>



<div class="viewcode-block" id="get_several_artists">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_several_artists">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_several_artists</span><span class="p">(</span><span class="n">artist_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Spotify catalog information for several artists based on their Spotify IDs.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-multiple-artists</span>

<span class="sd">    :param artist_ids: A comma-separated list of the Spotify IDs for the artists.</span>
<span class="sd">    :return: Dict containing Spotify Artists, in the form of {artist_uri: artist}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_ids</span><span class="p">(</span><span class="n">spotify_ids</span><span class="o">=</span><span class="n">artist_ids</span><span class="p">):</span>
        <span class="n">invalid_artists</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_invalid_spotify_ids</span><span class="p">(</span><span class="n">spotify_ids</span><span class="o">=</span><span class="n">artist_ids</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">invalid_artists</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;artist&quot;</span><span class="p">)</span>

    <span class="n">artists</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">current_chunk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">artist_ids</span><span class="p">),</span> <span class="mi">50</span><span class="p">):</span>
        <span class="n">encoded_chunk</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">artist_ids</span><span class="p">[</span><span class="n">current_chunk</span><span class="p">:</span> <span class="n">current_chunk</span> <span class="o">+</span> <span class="mi">50</span><span class="p">]))</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/artists?ids=</span><span class="si">{</span><span class="n">encoded_chunk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;artists&quot;</span><span class="p">]}</span>
        <span class="n">artists</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">artists</span></div>



<div class="viewcode-block" id="get_artists_albums">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_artists_albums">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_artists_albums</span><span class="p">(</span><span class="n">artist_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Spotify catalog information about an artist&#39;s albums.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-an-artists-albums</span>

<span class="sd">    :param artist_id: The Spotify ID of the artist.</span>
<span class="sd">    :param limit: The maximum number of items to return.</span>
<span class="sd">    :return: Dict containing Spotify Albums, in the form of {album_uri: album}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    :raises LimitException: if limit is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">artist_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">artist_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;artist&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">check_limits</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">LimitException</span><span class="p">(</span><span class="n">invalid_limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>

    <span class="n">albums</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Get first (up to) 50 artists</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/artists/</span><span class="si">{</span><span class="n">artist_id</span><span class="si">}</span><span class="s2">/albums?market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&amp;limit=</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="p">)</span><span class="si">}</span><span class="s2">&amp;offset=0&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
    <span class="n">albums</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="c1"># If there are more than 50 albums:</span>
    <span class="n">total_albums</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">current_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">total_albums</span><span class="p">,</span> <span class="n">limit</span><span class="p">),</span> <span class="mi">50</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/artists/</span><span class="si">{</span><span class="n">artist_id</span><span class="si">}</span><span class="s2">/albums?market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&amp;limit=50&amp;offset=</span><span class="si">{</span><span class="n">current_offset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
        <span class="n">albums</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">albums</span></div>



<div class="viewcode-block" id="get_artists_top_tracks">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_artists_top_tracks">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_artists_top_tracks</span><span class="p">(</span><span class="n">artist_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Spotify catalog information about an artist&#39;s top tracks by country.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-an-artists-top-tracks</span>

<span class="sd">    :param artist_id: The Spotify ID of the artist.</span>
<span class="sd">    :return: Dict containing Spotify Tracks, in the form of {track_uri: track}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">artist_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">artist_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;artist&quot;</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/artists/</span><span class="si">{</span><span class="n">artist_id</span><span class="si">}</span><span class="s2">/top-tracks?market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;tracks&quot;</span><span class="p">]}</span></div>



<span class="c1"># &lt;-- Begin Spotify Market Methods --&gt;</span>
<div class="viewcode-block" id="get_available_markets">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_available_markets">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_available_markets</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the list of markets (ISO 3166-1 alpha-2 country codes) where Spotify is available.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-available-markets</span>

<span class="sd">    Country Codes: https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2</span>
<span class="sd">    :return: List of available markets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/markets&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;markets&quot;</span><span class="p">]</span></div>



<span class="c1"># &lt;-- Begin Spotify Player Methods --&gt;</span>
<div class="viewcode-block" id="get_playback_state">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_playback_state">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_playback_state</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get information about the user’s current playback state, including track or episode, progress, and active device.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-read-playback-state&#39;</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-information-about-the-users-current-playback</span>

<span class="sd">    :return: Dict containing information about playback</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/player?market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span></div>



<div class="viewcode-block" id="transfer_playback">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.transfer_playback">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">transfer_playback</span><span class="p">(</span><span class="n">new_device_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">playback_state</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transfer playback to a new device and optionally begin playback. This API only works for users who have Spotify Premium. The order of execution is not guaranteed when you use this API with other Player API endpoints.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-modify-playback-state&#39;</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/transfer-a-users-playback</span>

<span class="sd">    :param new_device_id: Spotify device ID</span>
<span class="sd">    :param playback_state: True: ensure playback happens on new device; False: keep the current playback state.</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">new_device_id</span><span class="p">,</span> <span class="n">is_device</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">new_device_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;device&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">playback_state</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">playback_state</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="n">request_body</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;device_ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">new_device_id</span><span class="p">],</span>
        <span class="s2">&quot;play&quot;</span><span class="p">:</span> <span class="n">playback_state</span>
    <span class="p">}</span>

    <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/player&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="n">request_body</span><span class="p">,</span>
        <span class="n">json_as_data</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="get_available_devices">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_available_devices">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_available_devices</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get information about a user’s available Spotify Connect devices. Some device models are not supported and will not be listed in the API response.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-read-playback-state&#39;</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-a-users-available-devices</span>

<span class="sd">    :return: Dict containing information about available devices, in the form of {device_uri: device} (Device uri is NOT official)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/player/devices&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;spotify:device:</span><span class="si">{</span><span class="n">current_device</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">current_device</span> <span class="k">for</span> <span class="n">current_device</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;devices&quot;</span><span class="p">]}</span></div>



<div class="viewcode-block" id="get_device">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_device">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_device</span><span class="p">(</span><span class="n">device_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get information about a user’s Spotify Connect device. Some device models are not supported and will not be listed in the API response.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-read-playback-state</span>

<span class="sd">    :param device_id: what device to get information about</span>
<span class="sd">    :return: Dict containing information about the device, in the form of {device_uri: device} (Device uri is NOT official)</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">device_id</span><span class="p">,</span> <span class="n">is_device</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">device_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;device&quot;</span><span class="p">)</span>

    <span class="n">available_devices</span> <span class="o">=</span> <span class="n">get_available_devices</span><span class="p">()</span>
    <span class="n">target_device</span> <span class="o">=</span> <span class="n">available_devices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;spotify:device:</span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;spotify:device:</span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">target_device</span><span class="p">}</span> <span class="k">if</span> <span class="n">target_device</span> <span class="k">else</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="get_currently_playing_track">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_currently_playing_track">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_currently_playing_track</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the object currently being played on the user&#39;s Spotify account.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-read-currently-playing&#39;</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-the-users-currently-playing-track</span>

<span class="sd">    :return: Dict containing information about currently playing track</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/player/currently-playing?market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span></div>



<div class="viewcode-block" id="start_or_resume_playback">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.start_or_resume_playback">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">start_or_resume_playback</span><span class="p">(</span><span class="n">target_device_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Start a new context or resume current playback on the user&#39;s active device. This API only works for users who have Spotify Premium. The order of execution is not guaranteed when you use this API with other Player API endpoints.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-modify-playback-state&#39;</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/start-a-users-playback</span>

<span class="sd">    :param target_device_id: Spotify Device ID (If not supplied, the user&#39;s currently active device is the target)</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">target_device_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">is_device</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;device&quot;</span><span class="p">)</span>

    <span class="c1"># Note: Currently switching device results in 403 error with no clue why</span>
    <span class="c1">#   Spotify switches device and stops/aborts playback with &quot;Error&quot;</span>
    <span class="n">target_device_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># only working if Spotify not playing anything (if called while playing -&gt; Error)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">get_playback_state</span><span class="p">()[</span><span class="s1">&#39;is_playing&#39;</span><span class="p">]:</span>
        <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/player/play</span><span class="si">{</span><span class="s2">&quot;?device_id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">target_device_id</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">target_device_id</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="pause_playback">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.pause_playback">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">pause_playback</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pause playback on the user&#39;s account. This API only works for users who have Spotify Premium. The order of execution is not guaranteed when you use this API with other Player API endpoints.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-modify-playback-state&#39;</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/pause-a-users-playback</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># only working if Spotify playing anything (if called while paused -&gt; Error)</span>
    <span class="k">if</span> <span class="n">get_playback_state</span><span class="p">()[</span><span class="s1">&#39;is_playing&#39;</span><span class="p">]:</span>
        <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/player/pause&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="skip_to_next">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.skip_to_next">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">skip_to_next</span><span class="p">(</span><span class="n">target_device_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Skips to next track in the user’s queue. This API only works for users who have Spotify Premium. The order of execution is not guaranteed when you use this API with other Player API endpoints.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-modify-playback-state&#39;</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/skip-users-playback-to-next-track</span>

<span class="sd">    :param target_device_id: Spotify Device ID (If not supplied, the user&#39;s currently active device is the target)</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">target_device_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">is_device</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;device&quot;</span><span class="p">)</span>

    <span class="c1"># Note: Currently switching device results in 403 error with no clue why</span>
    <span class="c1">#   Spotify switches device and stops/aborts playback with &quot;Error&quot;</span>
    <span class="n">target_device_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/player/next</span><span class="si">{</span><span class="s2">&quot;?device_id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">target_device_id</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">target_device_id</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="skip_to_previous">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.skip_to_previous">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">skip_to_previous</span><span class="p">(</span><span class="n">target_device_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Skips to previous track in the user’s queue. This API only works for users who have Spotify Premium. The order of execution is not guaranteed when you use this API with other Player API endpoints.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-modify-playback-state&#39;</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/skip-users-playback-to-previous-track</span>

<span class="sd">    :param target_device_id: Spotify Device ID (If not supplied, the user&#39;s currently active device is the target)</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">target_device_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">is_device</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;device&quot;</span><span class="p">)</span>

    <span class="c1"># Note: Currently switching device results in 403 error with no clue why</span>
    <span class="c1">#   Spotify switches device and stops/aborts playback with &quot;Error&quot;</span>
    <span class="n">target_device_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/player/previous</span><span class="si">{</span><span class="s2">&quot;?device_id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">target_device_id</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">target_device_id</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="seek_to_position">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.seek_to_position">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">seek_to_position</span><span class="p">(</span><span class="n">position_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">target_device_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Seeks to the given position in the user’s currently playing track. This API only works for users who have Spotify Premium. The order of execution is not guaranteed when you use this API with other Player API endpoints.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-modify-playback-state&#39;</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/seek-to-position-in-currently-playing-track</span>

<span class="sd">    :param position_ms: The position in milliseconds to seek to. Must be a positive number. Passing in a position that is greater than the length of the track will cause the player to start playing the next song.</span>
<span class="sd">    :param target_device_id: Spotify Device ID (If not supplied, the user&#39;s currently active device is the target)</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">position_ms</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">position_ms</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="s2">&quot;positive integer&quot;</span><span class="p">,</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">target_device_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">is_device</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;device&quot;</span><span class="p">)</span>

    <span class="c1"># Note: Currently switching device results in 403 error with no clue why</span>
    <span class="c1">#   Spotify switches device and stops/aborts playback with &quot;Error&quot;</span>
    <span class="n">target_device_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">position_ms</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">position_ms</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span>
            <span class="n">item_value</span><span class="o">=</span><span class="n">position_ms</span><span class="p">,</span>
            <span class="n">valid_values</span><span class="o">=</span><span class="s2">&quot;positive integer&quot;</span><span class="p">,</span>
            <span class="n">valid_types</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/player/seek?position_ms=</span><span class="si">{</span><span class="n">position_ms</span><span class="si">}{</span><span class="s2">&quot;&amp;device_id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">target_device_id</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">target_device_id</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="set_repeat_mode">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.set_repeat_mode">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_repeat_mode</span><span class="p">(</span><span class="n">new_repeat_mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">,</span> <span class="s2">&quot;context&quot;</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">],</span> <span class="n">target_device_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the repeat mode for the user&#39;s playback. This API only works for users who have Spotify Premium. The order of execution is not guaranteed when you use this API with other Player API endpoints.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-modify-playback-state&#39;</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/set-repeat-mode-on-users-playback</span>

<span class="sd">    :param new_repeat_mode: track: will repeat the current track; context: will repeat the current context; off: will turn repeat off.</span>
<span class="sd">    :param target_device_id: Spotify Device ID (If not supplied, the user&#39;s currently active device is the target)</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    :raises CustomException: If Exception occurs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_repeat_mode</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">new_repeat_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">,</span> <span class="s2">&quot;context&quot;</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">new_repeat_mode</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;track&quot;</span><span class="p">,</span> <span class="s2">&quot;context&quot;</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">target_device_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">is_device</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;device&quot;</span><span class="p">)</span>

    <span class="c1"># Note: Currently switching device results in 403 error with no clue why</span>
    <span class="c1">#   Spotify switches device and stops/aborts playback with &quot;Error&quot;</span>
    <span class="n">target_device_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">new_repeat_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">,</span> <span class="s2">&quot;context&quot;</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">]:</span>
        <span class="n">CustomException</span><span class="p">(</span>
            <span class="n">error_message</span><span class="o">=</span><span class="s2">&quot;new_repeat_mode must be one of &#39;track&#39;, &#39;context&#39;, &#39;off&#39;&quot;</span><span class="p">,</span>
            <span class="n">more_infos</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Entered invalid repeat mode: &#39;</span><span class="si">{</span><span class="n">new_repeat_mode</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span>

    <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/player/repeat?state=</span><span class="si">{</span><span class="n">new_repeat_mode</span><span class="si">}{</span><span class="s2">&quot;&amp;device_id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">target_device_id</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">target_device_id</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="set_playback_volume">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.set_playback_volume">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_playback_volume</span><span class="p">(</span><span class="n">new_volume</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">target_device_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the volume for the user’s current playback device. This API only works for users who have Spotify Premium. The order of execution is not guaranteed when you use this API with other Player API endpoints.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-modify-playback-state&#39;</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/set-volume-for-users-playback</span>

<span class="sd">    :param new_volume: The volume to set. Must be a value from 0 to 100 inclusive.</span>
<span class="sd">    :param target_device_id: Spotify Device ID (If not supplied, the user&#39;s currently active device is the target)</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_volume</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span> <span class="o">&gt;</span> <span class="n">new_volume</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">new_volume</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="s2">&quot;0 &lt;= new_volume &lt;= 100&quot;</span><span class="p">,</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">target_device_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">is_device</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;device&quot;</span><span class="p">)</span>

    <span class="c1"># Note: Currently switching device results in 403 error with no clue why</span>
    <span class="c1">#   Spotify switches device and stops/aborts playback with &quot;Error&quot;</span>
    <span class="n">target_device_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/player/volume?volume_percent=</span><span class="si">{</span><span class="n">new_volume</span><span class="si">}{</span><span class="s2">&quot;&amp;device_id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">target_device_id</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">target_device_id</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="toggle_playback_shuffle">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.toggle_playback_shuffle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">toggle_playback_shuffle</span><span class="p">(</span><span class="n">new_state</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">target_device_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Toggle shuffle on or off for user’s playback. This API only works for users who have Spotify Premium. The order of execution is not guaranteed when you use this API with other Player API endpoints.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-modify-playback-state&#39;</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/toggle-shuffle-for-users-playback</span>

<span class="sd">    :param new_state: True: Shuffle user&#39;s playback; False: Do not shuffle user&#39;s playback.</span>
<span class="sd">    :param target_device_id: Spotify Device ID (If not supplied, the user&#39;s currently active device is the target)</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_state</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">new_state</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">target_device_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">is_device</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;device&quot;</span><span class="p">)</span>

    <span class="c1"># Note: Currently switching device results in 403 error with no clue why</span>
    <span class="c1">#   Spotify switches device and stops/aborts playback with &quot;Error&quot;</span>
    <span class="n">target_device_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/player/shuffle?state=</span><span class="si">{</span><span class="n">new_state</span><span class="si">}{</span><span class="s2">&quot;&amp;device_id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">target_device_id</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">target_device_id</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="get_recently_played_tracks">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_recently_played_tracks">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_recently_played_tracks</span><span class="p">(</span><span class="n">limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">after</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">before</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get tracks from the current user&#39;s recently played tracks. Note: Currently doesn&#39;t support podcast episodes.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-read-recently-played&#39;</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-recently-played</span>

<span class="sd">    :param limit: The maximum number of items to return. Default: 20. Minimum: 1. Maximum: 50.</span>
<span class="sd">    :param after: A Unix timestamp in milliseconds. Returns all items after (but not including) this cursor position. If after is specified, before must not be specified.</span>
<span class="sd">    :param before: A Unix timestamp in milliseconds. Returns all items before (but not including) this cursor position. If before is specified, after must not be specified.</span>
<span class="sd">    :return: Dict containing Spotify Tracks, in the form of {track_uri: track}</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    :raises LimitException: if limit is invalid</span>
<span class="sd">    :raises CustomException: If Exception occurs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">check_limits</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">LimitException</span><span class="p">(</span><span class="n">invalid_limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">after</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">after</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">after</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="s2">&quot;valid Unix timestamp in milliseconds&quot;</span><span class="p">,</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/player/recently-played?limit=</span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2">&amp;after=</span><span class="si">{</span><span class="n">after</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">before</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CORANGE</span><span class="si">}</span><span class="s2">ignoring parameter before&quot;</span><span class="p">,</span> <span class="n">TEXTCOLOR</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">before</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">before</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="s2">&quot;valid Unix timestamp in milliseconds&quot;</span><span class="p">,</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/player/recently-played?limit=</span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2">&amp;before=</span><span class="si">{</span><span class="n">before</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">CustomException</span><span class="p">(</span>
            <span class="n">error_message</span><span class="o">=</span><span class="s2">&quot;Either after or before must be specified&quot;</span><span class="p">,</span>
            <span class="n">more_infos</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;after=</span><span class="si">{</span><span class="n">after</span><span class="si">}</span><span class="s2">; before=</span><span class="si">{</span><span class="n">before</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span>

    <span class="n">check_limits</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="n">max_limit</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">current_item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span></div>



<div class="viewcode-block" id="get_the_users_queue">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_the_users_queue">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_the_users_queue</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the list of objects that make up the user&#39;s queue.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-read-currently-playing&#39;, &#39;user-read-playback-state&#39;</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-queue</span>

<span class="sd">    :return: ordered Dict containing Spotify queued Tracks, in the form of {track_uri: track}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://api.spotify.com/v1/me/player/queue&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span>
    <span class="p">)</span>

    <span class="n">queue</span> <span class="o">=</span> <span class="p">{</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;currently_playing&quot;</span><span class="p">][</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;currently_playing&quot;</span><span class="p">]}</span>
    <span class="n">queue</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">current_item</span> <span class="k">for</span> <span class="n">current_item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;queue&quot;</span><span class="p">]})</span>

    <span class="n">queue</span> <span class="o">=</span> <span class="n">remove_key_recursively</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="s2">&quot;available_markets&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">queue</span></div>



<div class="viewcode-block" id="add_item_to_playback_queue">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.add_item_to_playback_queue">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_item_to_playback_queue</span><span class="p">(</span><span class="n">track_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_device_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add an item to the end of the user&#39;s current playback queue. This API only works for users who have Spotify Premium. The order of execution is not guaranteed when you use this API with other Player API endpoints.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-modify-playback-state&#39;</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/add-to-queue</span>

<span class="sd">    :param track_uri: The Spotify Track URIs to be queued.</span>
<span class="sd">    :param target_device_id: Spotify Device ID (If not supplied, the user&#39;s currently active device is the target)</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    :raises SpotifyUriException: if spotify uri is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_uri</span><span class="p">(</span><span class="n">spotify_uri</span><span class="o">=</span><span class="n">track_uri</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyUriException</span><span class="p">(</span><span class="n">invalid_uri</span><span class="o">=</span><span class="n">track_uri</span><span class="p">,</span> <span class="n">uri_type</span><span class="o">=</span><span class="s2">&quot;track&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">target_device_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">is_device</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;device&quot;</span><span class="p">)</span>

    <span class="c1"># Note: Currently switching device results in 403 error with no clue why</span>
    <span class="c1">#   Spotify switches device and stops/aborts playback with &quot;Error&quot;</span>
    <span class="n">target_device_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">encoded_uri</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="n">track_uri</span><span class="p">)</span>
    <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/player/queue?uri=</span><span class="si">{</span><span class="n">encoded_uri</span><span class="si">}{</span><span class="s2">&quot;&amp;device_id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">target_device_id</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">target_device_id</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="add_several_items_to_playback_queue">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.add_several_items_to_playback_queue">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_several_items_to_playback_queue</span><span class="p">(</span><span class="n">track_uris</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">target_device_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add multiple items to the end of the user&#39;s current playback queue. This API only works for users who have Spotify Premium. The order of execution is not guaranteed when you use this API with other Player API endpoints.</span>

<span class="sd">    :param track_uris: A list of the Spotify Track URIs to be queued.</span>
<span class="sd">    :param target_device_id: Spotify Device ID (If not supplied, the user&#39;s currently active device is the target)</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    :raises SpotifyUriException: if spotify uri is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_uris</span><span class="p">(</span><span class="n">spotify_uris</span><span class="o">=</span><span class="n">track_uris</span><span class="p">):</span>
        <span class="n">invalid_uris</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_invalid_spotify_uris</span><span class="p">(</span><span class="n">spotify_uris</span><span class="o">=</span><span class="n">track_uris</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">SpotifyUriException</span><span class="p">(</span><span class="n">invalid_uri</span><span class="o">=</span><span class="n">invalid_uris</span><span class="p">,</span> <span class="n">uri_type</span><span class="o">=</span><span class="s2">&quot;track&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">target_device_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">is_device</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;device&quot;</span><span class="p">)</span>

    <span class="c1"># Note: Currently switching device results in 403 error with no clue why</span>
    <span class="c1">#   Spotify switches device and stops/aborts playback with &quot;Error&quot;</span>
    <span class="n">target_device_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Warning: Does not use API optimization, because there is no Web API method for this by Spotify</span>
    <span class="c1">#   If HTTP Error 429 occurs multiple times set time.sleep(X) between the iterations</span>
    <span class="k">for</span> <span class="n">current_uri</span> <span class="ow">in</span> <span class="n">track_uris</span><span class="p">:</span>
        <span class="n">add_item_to_playback_queue</span><span class="p">(</span><span class="n">current_uri</span><span class="p">,</span> <span class="n">target_device_id</span><span class="o">=</span><span class="n">target_device_id</span><span class="p">)</span></div>

        <span class="c1"># time.sleep(X)</span>


<span class="c1"># &lt;-- Begin Spotify Playlist Methods --&gt;</span>
<div class="viewcode-block" id="get_playlist">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_playlist">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_playlist</span><span class="p">(</span><span class="n">playlist_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a playlist owned by a Spotify user.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-playlist</span>

<span class="sd">    :param playlist_id: The Spotify ID of the playlist.</span>
<span class="sd">    :return: Dict containing Spotify Playlists, in the form of {playlist_id: playlist}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;playlist&quot;</span><span class="p">)</span>

    <span class="c1"># Note: it could be that private playlists create errors (not tested)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/playlists/</span><span class="si">{</span><span class="n">playlist_id</span><span class="si">}</span><span class="s2">?market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">response</span><span class="p">}</span></div>



<div class="viewcode-block" id="get_several_playlists">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_several_playlists">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_several_playlists</span><span class="p">(</span><span class="n">playlist_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Spotify catalog information for multiple playlists based on their Spotify IDs.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-several-tracks</span>

<span class="sd">    :param playlist_ids: A list of the Spotify IDs to be checked.</span>
<span class="sd">    :return: Dict containing Spotify Tracks, in the form of {track_uri: track}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_ids</span><span class="p">(</span><span class="n">spotify_ids</span><span class="o">=</span><span class="n">playlist_ids</span><span class="p">):</span>
        <span class="n">invalid_playlists</span> <span class="o">=</span> <span class="n">get_invalid_spotify_ids</span><span class="p">(</span><span class="n">spotify_ids</span><span class="o">=</span><span class="n">playlist_ids</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">invalid_playlists</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;playlist&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">check_limits</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">playlist_ids</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">playlists</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Warning: Does not use API optimization, because there is no Web API method for this by Spotify</span>
    <span class="c1">#   If HTTP Error 429 occurs multiple times set time.sleep(X) between the iterations</span>
    <span class="k">for</span> <span class="n">current_playlist_id</span> <span class="ow">in</span> <span class="n">playlist_ids</span><span class="p">:</span>
        <span class="n">current_playlist</span> <span class="o">=</span> <span class="n">get_playlist</span><span class="p">(</span><span class="n">playlist_id</span><span class="o">=</span><span class="n">current_playlist_id</span><span class="p">)</span>
        <span class="n">playlists</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">current_playlist</span><span class="p">)</span>
        <span class="c1"># time.sleep(X)</span>

    <span class="k">return</span> <span class="n">playlists</span></div>



<div class="viewcode-block" id="change_playlist_details">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.change_playlist_details">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">change_playlist_details</span><span class="p">(</span><span class="n">playlist_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">public</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">collaborative</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Change a playlist&#39;s name and public/private state. (The user must, of course, own the playlist.)</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** playlist-modify-public, playlist-modify-private</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/change-playlist-details</span>

<span class="sd">    :param playlist_id: The Spotify ID of the playlist.</span>
<span class="sd">    :param name: The new name for the playlist, for example &quot;My New Playlist Title&quot;</span>
<span class="sd">    :param public: The playlist&#39;s public/private status (if it should be added to the user&#39;s profile or not): true the playlist will be public, false the playlist will be private, null the playlist status is not relevant. For more about public/private status, see [Working with Playlists](https://developer.spotify.com/documentation/web-api/concepts/playlists)</span>
<span class="sd">    :param collaborative: If `true`, the playlist will become collaborative and other users will be able to modify the playlist in their Spotify client. Note: You can only set `collaborative=true` on non-public playlists.</span>
<span class="sd">    :param description: Value for playlist description as displayed in Spotify Clients and in the Web API.</span>
<span class="sd">    :return: Updates Playlist in App</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;playlist&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="s2">&quot;(suitable playlist name)&quot;</span><span class="p">,</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">public</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">public</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">collaborative</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">collaborative</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="s2">&quot;(suitable playlist description)&quot;</span><span class="p">,</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="n">json_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
        <span class="s1">&#39;public&#39;</span><span class="p">:</span> <span class="n">public</span><span class="p">,</span>
        <span class="s1">&#39;collaborative&#39;</span><span class="p">:</span> <span class="n">collaborative</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/playlists/</span><span class="si">{</span><span class="n">playlist_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="n">json_data</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="get_playlist_items">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_playlist_items">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_playlist_items</span><span class="p">(</span><span class="n">playlist_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">get_duration</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ignore_market</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get full details of the items of a playlist owned by a Spotify user.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** playlist-read-private</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-playlists-tracks</span>

<span class="sd">    :param playlist_id: The Spotify ID of the playlist.</span>
<span class="sd">    :param get_duration: If to get the Playlist duration in seconds. Default: False.</span>
<span class="sd">    :param ignore_market: Whether to ignore market.</span>
<span class="sd">    :return: Dict containing Spotify Tracks, in the form of {track_uri: track} (and optional the duration as second param)</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    :raises CustomException: If Exception occurs</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;playlist&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">get_duration</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">get_duration</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ignore_market</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">ignore_market</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="n">tracks</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Get first (up to) 50 artists</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/playlists/</span><span class="si">{</span><span class="n">playlist_id</span><span class="si">}</span><span class="s2">/tracks?limit=50&amp;offset=0</span><span class="si">{</span><span class="sa">f</span><span class="s2">&quot;&amp;market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ignore_market</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
    <span class="n">tracks</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="c1"># If there are more than 50 albums:</span>
    <span class="n">total_tracks</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">current_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">total_tracks</span><span class="p">,</span> <span class="mi">50</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/playlists/</span><span class="si">{</span><span class="n">playlist_id</span><span class="si">}</span><span class="s2">/tracks?limit=50&amp;offset=</span><span class="si">{</span><span class="n">current_offset</span><span class="si">}</span><span class="s2">&amp;market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
        <span class="n">tracks</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tracks</span><span class="p">)</span> <span class="o">!=</span> <span class="n">total_tracks</span><span class="p">:</span>
        <span class="n">CustomException</span><span class="p">(</span>
            <span class="n">error_message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Could not fetch all Playlist &#39;</span><span class="si">{</span><span class="n">playlist_id</span><span class="si">}</span><span class="s2">&#39; items&quot;</span><span class="p">,</span>
            <span class="n">more_infos</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Tracks fetched: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tracks</span><span class="p">)</span><span class="si">}</span><span class="s2">, Tracks in Playlist: </span><span class="si">{</span><span class="n">total_tracks</span><span class="si">}</span><span class="s2"> (This difference can be due to duplicates in the Playlist.)&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">get_duration</span><span class="p">:</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">current_track</span><span class="p">[</span><span class="s2">&quot;duration_ms&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">current_track</span> <span class="ow">in</span> <span class="n">tracks</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">tracks</span><span class="p">,</span> <span class="n">duration</span>

    <span class="k">return</span> <span class="n">tracks</span></div>



<div class="viewcode-block" id="update_playlist_items">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.update_playlist_items">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_playlist_items</span><span class="p">(</span><span class="n">playlist_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">track_uris</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Own implementation to update a Playlist</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** playlist-read-private, playlist-modify-public, playlist-modify-private</span>

<span class="sd">    :param playlist_id: The Spotify ID of the playlist.</span>
<span class="sd">    :param track_uris: A comma-separated list of Spotify URIs to add.</span>
<span class="sd">    :return: Updates Playlist in App</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    :raises SpotifyUriException: if spotify uri is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;playlist&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_uris</span><span class="p">(</span><span class="n">spotify_uris</span><span class="o">=</span><span class="n">track_uris</span><span class="p">):</span>
        <span class="n">invalid_uris</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_invalid_spotify_uris</span><span class="p">(</span><span class="n">spotify_uris</span><span class="o">=</span><span class="n">track_uris</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">SpotifyUriException</span><span class="p">(</span><span class="n">invalid_uri</span><span class="o">=</span><span class="n">invalid_uris</span><span class="p">,</span> <span class="n">uri_type</span><span class="o">=</span><span class="s2">&quot;track&quot;</span><span class="p">)</span>

    <span class="c1"># Fetch and remove current Tracks</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">get_playlist_items</span><span class="p">(</span><span class="n">playlist_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">remove_playlist_items</span><span class="p">(</span>
            <span class="n">playlist_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">,</span>
            <span class="n">track_uris</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="p">)</span>

    <span class="c1"># Add new items</span>
    <span class="n">add_items_to_playlist</span><span class="p">(</span>
        <span class="n">playlist_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">,</span>
        <span class="n">track_uris</span><span class="o">=</span><span class="n">track_uris</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="add_items_to_playlist">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.add_items_to_playlist">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_items_to_playlist</span><span class="p">(</span><span class="n">playlist_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">track_uris</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Append one or more items to a user&#39;s playlist.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** playlist-modify-public, playlist-modify-private</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/add-tracks-to-playlist</span>

<span class="sd">    :param playlist_id: The Spotify ID of the playlist.</span>
<span class="sd">    :param track_uris: A list of Spotify URIs to add</span>
<span class="sd">    :return: Updates Playlist in App</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    :raises SpotifyUriException: if spotify uri is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;playlist&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_uris</span><span class="p">(</span><span class="n">spotify_uris</span><span class="o">=</span><span class="n">track_uris</span><span class="p">):</span>
        <span class="n">invalid_uris</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_invalid_spotify_uris</span><span class="p">(</span><span class="n">spotify_uris</span><span class="o">=</span><span class="n">track_uris</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">SpotifyUriException</span><span class="p">(</span><span class="n">invalid_uri</span><span class="o">=</span><span class="n">invalid_uris</span><span class="p">,</span> <span class="n">uri_type</span><span class="o">=</span><span class="s2">&quot;track&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">current_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">track_uris</span><span class="p">),</span> <span class="mi">100</span><span class="p">):</span>
        <span class="c1"># Note: The position [...] If omitted, the items will be appended to the playlist. [...]</span>
        <span class="c1">#  -&gt; no position should work. Otherwise or if position is needed uncomment and update value</span>
        <span class="c1"># Additionally, the URIs are in the Body instead of passing numerous item URIs as a query parameter and</span>
        <span class="c1"># therefore, avoiding the surpassing of the maximum length of the request URI</span>

        <span class="n">json_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;uris&quot;</span><span class="p">:</span> <span class="n">track_uris</span><span class="p">[</span><span class="n">current_offset</span><span class="p">:</span><span class="n">current_offset</span> <span class="o">+</span> <span class="mi">100</span><span class="p">]</span>
            <span class="c1"># &quot;position&quot;: position</span>
        <span class="p">}</span>
        <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/playlists/</span><span class="si">{</span><span class="n">playlist_id</span><span class="si">}</span><span class="s2">/tracks&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
            <span class="n">json_data</span><span class="o">=</span><span class="n">json_data</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="remove_playlist_items">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.remove_playlist_items">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_playlist_items</span><span class="p">(</span><span class="n">playlist_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">track_uris</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove one or more items from a user&#39;s playlist (all appearances with these URIs/all Duplicates).</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** playlist-modify-public, playlist-modify-private</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/remove-tracks-playlist</span>

<span class="sd">    :param playlist_id: The Spotify ID of the playlist.</span>
<span class="sd">    :param track_uris: An array of objects containing Spotify URIs of the tracks or episodes to remove.</span>
<span class="sd">    :return: Updates Playlist in App</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    :raises SpotifyUriException: if spotify uri is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;playlist&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_uris</span><span class="p">(</span><span class="n">spotify_uris</span><span class="o">=</span><span class="n">track_uris</span><span class="p">):</span>
        <span class="n">invalid_uris</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_invalid_spotify_uris</span><span class="p">(</span><span class="n">spotify_uris</span><span class="o">=</span><span class="n">track_uris</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">SpotifyUriException</span><span class="p">(</span><span class="n">invalid_uri</span><span class="o">=</span><span class="n">invalid_uris</span><span class="p">,</span> <span class="n">uri_type</span><span class="o">=</span><span class="s2">&quot;track&quot;</span><span class="p">)</span>

    <span class="n">original_tracks</span> <span class="o">=</span> <span class="n">get_original_tracks</span><span class="p">(</span><span class="n">track_uris</span><span class="p">)</span>
    <span class="n">track_dict</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;uri&quot;</span><span class="p">:</span> <span class="n">item</span><span class="p">}</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">original_tracks</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">current_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">track_uris</span><span class="p">),</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;tracks&#39;</span><span class="p">:</span> <span class="n">track_dict</span><span class="p">[</span><span class="n">current_offset</span><span class="p">:</span><span class="n">current_offset</span> <span class="o">+</span> <span class="mi">100</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/playlists/</span><span class="si">{</span><span class="n">playlist_id</span><span class="si">}</span><span class="s2">/tracks&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;DELETE&quot;</span><span class="p">,</span>
            <span class="n">json_data</span><span class="o">=</span><span class="n">json_data</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="get_current_users_playlists">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_current_users_playlists">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_current_users_playlists</span><span class="p">(</span><span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a list of the playlists owned or followed by the current Spotify user.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** playlist-read-private</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-a-list-of-current-users-playlists</span>

<span class="sd">    :param limit: The maximum number of items to return.  If `limit=None` **all** Top Playlists get returned. Default: 20. Minimum: 1.</span>
<span class="sd">    :return: Dict containing Spotify Playlists, in the form of {playlist_uri: playlist}</span>
<span class="sd">    :raises LimitException: if limit is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">check_limits</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">LimitException</span><span class="p">(</span><span class="n">invalid_limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">check_limits</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">playlists</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Get first (up to) 50 artists</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/playlists?limit=</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="p">)</span><span class="si">}</span><span class="s2">&amp;offset=0&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
    <span class="n">playlists</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="c1"># If there are more than 50 albums:</span>
    <span class="n">total_playlists</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">current_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">total_playlists</span><span class="p">,</span> <span class="n">limit</span><span class="p">),</span> <span class="mi">50</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/playlists?limit=50&amp;offset=</span><span class="si">{</span><span class="n">current_offset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
        <span class="n">playlists</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">playlists</span></div>



<div class="viewcode-block" id="get_users_playlists">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_users_playlists">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_users_playlists</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a list of the playlists owned or followed by a Spotify user.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** playlist-read-private, playlist-read-collaborative</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-list-users-playlists</span>

<span class="sd">    :param user_id: The user&#39;s Spotify ID.</span>
<span class="sd">    :param limit: The maximum number of items to return.  If `limit=None` **all** Top Playlists get returned. Default: 20. Minimum: 1.</span>
<span class="sd">    :return: Dict containing Spotify Playlists, in the form of {playlist_uri: playlist}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    :raises LimitException: if limit is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">is_user</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">check_limits</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">LimitException</span><span class="p">(</span><span class="n">invalid_limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="mi">51</span>

    <span class="k">if</span> <span class="n">check_limits</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">playlists</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Get first (up to) 50 artists</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/users/</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">/playlists?limit=</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="p">)</span><span class="si">}</span><span class="s2">&amp;offset=0&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
    <span class="n">playlists</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="c1"># If there are more than 50 albums:</span>
    <span class="n">total_playlists</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">current_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">total_playlists</span><span class="p">,</span> <span class="n">limit</span><span class="p">),</span> <span class="mi">50</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/users/</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">/playlists?limit=50&amp;offset=</span><span class="si">{</span><span class="n">current_offset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
        <span class="n">playlists</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">playlists</span></div>



<div class="viewcode-block" id="create_playlist">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.create_playlist">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_playlist</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">public</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">collaborative</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a playlist for a Spotify user. (The playlist will be empty until you add tracks.) Each user is generally limited to a maximum of 11000 playlists.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** playlist-modify-public, playlist-modify-private</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/create-playlist</span>

<span class="sd">    :param user_id: The user&#39;s Spotify ID.</span>
<span class="sd">    :param name: The name for the new playlist, for example &quot;Your Coolest Playlist&quot;. This name does not need to be unique; a user may have several playlists with the same name.</span>
<span class="sd">    :param public: Defaults to true. The playlist&#39;s public/private status (if it should be added to the user&#39;s profile or not): true the playlist will be public, false the playlist will be private. To be able to create private playlists, the user must have granted the &quot;playlist-modify-private&quot; scope. For more about public/private status, see Working with Playlists</span>
<span class="sd">    :param collaborative: Defaults to false. If true the playlist will be collaborative. Note: to create a collaborative playlist you must also set public to false. To create collaborative playlists you must have granted &quot;playlist-modify-private&quot; and &quot;playlist-modify-public&quot; scopes.</span>
<span class="sd">    :param description: value for playlist description as displayed in Spotify Clients and in the Web API.</span>
<span class="sd">    :return: Dict containing Spotify Playlists, in the form of {playlist_uri: playlist}</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">is_user</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="s2">&quot;(suitable playlist name)&quot;</span><span class="p">,</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">public</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">public</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">collaborative</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">collaborative</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="s2">&quot;(suitable playlist description)&quot;</span><span class="p">,</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="n">json_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
        <span class="s2">&quot;public&quot;</span><span class="p">:</span> <span class="n">public</span><span class="p">,</span>
        <span class="s2">&quot;collaborative&quot;</span><span class="p">:</span> <span class="n">collaborative</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/users/</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">/playlists&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="n">json_data</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">response</span><span class="p">}</span></div>



<div class="viewcode-block" id="get_playlist_cover_image">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_playlist_cover_image">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_playlist_cover_image</span><span class="p">(</span><span class="n">playlist_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ImageFile</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the current image associated with a specific playlist.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-playlist-cover</span>

<span class="sd">    :param playlist_id: The Spotify ID of the playlist.</span>
<span class="sd">    :return: Playlist Cover Image loaded as Pillow Image</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;playlist&quot;</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/playlists/</span><span class="si">{</span><span class="n">playlist_id</span><span class="si">}</span><span class="s2">/images&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">image_from_url</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;url&quot;</span><span class="p">])</span></div>



<div class="viewcode-block" id="add_custom_playlist_cover_image">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.add_custom_playlist_cover_image">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_custom_playlist_cover_image</span><span class="p">(</span><span class="n">playlist_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">b64_image</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replace the image used to represent a specific playlist.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** ugc-image-upload, playlist-modify-private, playlist-modify-public</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/upload-custom-playlist-cover</span>

<span class="sd">    :param playlist_id: The Spotify ID of the playlist.</span>
<span class="sd">    :param b64_image: Base64 encoded JPEG image data, maximum payload size is 256 KB.</span>
<span class="sd">    :return: Updates Playlist in App</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;playlist&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b64_image</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">b64_image</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="s2">&quot;(valid base64 image string)&quot;</span><span class="p">,</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">check_token_expired</span><span class="p">(</span><span class="n">extended_token</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">request_regular_token</span><span class="p">()</span>

    <span class="n">header</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;REGULAR_TOKEN&quot;</span><span class="p">))[</span><span class="s2">&quot;access_token&quot;</span><span class="p">],</span>
        <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s2">&quot;image/jpeg&quot;</span>
    <span class="p">}</span>

    <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/playlists/</span><span class="si">{</span><span class="n">playlist_id</span><span class="si">}</span><span class="s2">/images&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="n">b64_image</span><span class="p">,</span>
        <span class="n">overwrite_header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span>
        <span class="n">json_as_data</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="save_playlist_state">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.save_playlist_state">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">save_playlist_state</span><span class="p">(</span><span class="n">playlist_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save Collection state as a Dict in the form of {playlist_uri: playlist, track_uri: track} to file</span>

<span class="sd">    :param playlist_id: Spotify Playlist id</span>
<span class="sd">    :param filepath: where to save playlist state</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;playlist&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">absolute_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filepath</span><span class="p">)[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">filepath</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="s2">&quot;valid filepath&quot;</span><span class="p">,</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="n">playlist</span> <span class="o">=</span> <span class="n">get_playlist</span><span class="p">(</span><span class="n">playlist_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">)</span>
    <span class="n">playlist</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">get_playlist_items</span><span class="p">(</span><span class="n">playlist_id</span><span class="o">=</span><span class="n">playlist_id</span><span class="p">))</span>

    <span class="n">json_to_file</span><span class="p">(</span>
        <span class="n">json_filepath</span><span class="o">=</span><span class="n">filepath</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="n">playlist</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span></div>



<span class="c1"># &lt;-- Begin Spotify Search Methods --&gt;</span>
<div class="viewcode-block" id="search_for_item">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.search_for_item">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">search_for_item</span><span class="p">(</span>
        <span class="n">search_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">item_type</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;album&quot;</span><span class="p">,</span> <span class="s2">&quot;artist&quot;</span><span class="p">,</span> <span class="s2">&quot;playlist&quot;</span><span class="p">,</span> <span class="s2">&quot;track&quot;</span><span class="p">]],</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Spotify catalog information about albums, artists, playlists, tracks, shows, episodes or audiobooks that match a keyword string.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/search</span>

<span class="sd">    **Better Search queries:**</span>
<span class="sd">        (1) You can narrow down your search using field filters. The available filters are album, artist, track, year, upc, tag:hipster, tag:new, isrc, and genre. Each field filter only applies to certain result types.</span>
<span class="sd">        (2) The artist and year filters can be used while searching albums, artists and tracks. You can filter on a single year or a range (e.g. 1955-1960).</span>
<span class="sd">        (3) The album filter can be used while searching albums and tracks.</span>
<span class="sd">        (4) The genre filter can be used while searching artists and tracks.</span>
<span class="sd">        (5) The isrc and track filters can be used while searching tracks.</span>
<span class="sd">        (6) The upc, tag:new and tag:hipster filters can only be used while searching albums. The tag:new filter will return albums released in the past two weeks and tag:hipster can be used to return only albums with the lowest 10% popularity.</span>

<span class="sd">    :param search_query: Your search query.</span>
<span class="sd">    :param item_type: A comma-separated list of item types to search across. Search results include hits from all the specified item types. For example: &#39;q=abacab&amp;type=album,track&#39; returns both albums and tracks matching &quot;abacab&quot;.</span>
<span class="sd">    :param limit: The maximum number of results to return in each item type. Default: 20. Minimum: 1. Maximum: 50.</span>
<span class="sd">    :param offset: The index of the first result to return. Use with limit to get the next page of search results. Default: 0. Minimum: 0. Maximum: 1000-limit.</span>
<span class="sd">    :return: Dict containing the Search response, in the form of {item_uri: item}</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    :raises LimitException: if limit is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">search_query</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">search_query</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item_type</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">item_type</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">item_type</span><span class="p">)</span> <span class="o">-</span> <span class="p">{</span><span class="s2">&quot;album&quot;</span><span class="p">,</span> <span class="s2">&quot;artist&quot;</span><span class="p">,</span> <span class="s2">&quot;playlist&quot;</span><span class="p">,</span> <span class="s2">&quot;track&quot;</span><span class="p">})</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">item_type</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;album&quot;</span><span class="p">,</span> <span class="s2">&quot;artist&quot;</span><span class="p">,</span> <span class="s2">&quot;playlist&quot;</span><span class="p">,</span> <span class="s2">&quot;track&quot;</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">check_limits</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">LimitException</span><span class="p">(</span><span class="n">invalid_limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">check_limits</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">min_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_limit</span><span class="o">=</span><span class="mi">1000</span> <span class="o">-</span> <span class="n">limit</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;0 &lt;= offset &lt;= </span><span class="si">{</span><span class="mi">1000</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">limit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/search?q=</span><span class="si">{</span><span class="n">search_query</span><span class="si">}{</span><span class="s2">&quot;&amp;type=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">item_type</span><span class="p">)</span><span class="si">}</span><span class="s2">&amp;market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&amp;limit=</span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2">&amp;offset=</span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span>
    <span class="p">)</span>

    <span class="n">json_to_file</span><span class="p">(</span><span class="s2">&quot;code_backend/development_and_testing/debugging.json&quot;</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item_type</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">output</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">current_item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">current_item</span> <span class="k">for</span> <span class="n">current_item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span><span class="s2">&quot;items&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">current_item</span><span class="p">})</span>

    <span class="n">json_to_file</span><span class="p">(</span><span class="s2">&quot;code_backend/development_and_testing/debugging_2.json&quot;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output</span></div>



<span class="c1"># &lt;-- Begin Spotify Track Methods --&gt;</span>
<div class="viewcode-block" id="get_track">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_track">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_track</span><span class="p">(</span><span class="n">track_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ignore_market</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Spotify catalog information for a single track identified by its unique Spotify ID.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-track</span>

<span class="sd">    :param track_id: The Spotify ID for the track.</span>
<span class="sd">    :param ignore_market: Whether to ignore market.</span>
<span class="sd">    :return: Dict containing Spotify Tracks, in the form of {track_uri: track}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">track_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">track_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;track&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ignore_market</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">ignore_market</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/tracks/</span><span class="si">{</span><span class="n">track_id</span><span class="si">}{</span><span class="sa">f</span><span class="s2">&quot;?market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ignore_market</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">response</span><span class="p">}</span></div>



<div class="viewcode-block" id="get_several_tracks">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_several_tracks">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_several_tracks</span><span class="p">(</span><span class="n">track_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">ignore_market</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Spotify catalog information for multiple tracks based on their Spotify IDs.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-several-tracks</span>

<span class="sd">    :param track_ids: A list of the Spotify IDs to be checked.</span>
<span class="sd">    :return: Dict containing Spotify Tracks, in the form of {track_uri: track}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_ids</span><span class="p">(</span><span class="n">spotify_ids</span><span class="o">=</span><span class="n">track_ids</span><span class="p">):</span>
        <span class="n">invalid_tracks</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_invalid_spotify_ids</span><span class="p">(</span><span class="n">spotify_ids</span><span class="o">=</span><span class="n">track_ids</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">invalid_tracks</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;track&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ignore_market</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">ignore_market</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="n">tracks</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">current_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">track_ids</span><span class="p">),</span> <span class="mi">50</span><span class="p">):</span>
        <span class="n">encoded_chunk</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">track_ids</span><span class="p">[</span><span class="n">current_offset</span><span class="p">:</span> <span class="n">current_offset</span> <span class="o">+</span> <span class="mi">50</span><span class="p">]))</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/tracks?</span><span class="si">{</span><span class="sa">f</span><span class="s2">&quot;market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ignore_market</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2">ids=</span><span class="si">{</span><span class="n">encoded_chunk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;tracks&quot;</span><span class="p">]}</span>
        <span class="n">tracks</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tracks</span></div>



<div class="viewcode-block" id="get_users_saved_tracks">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_users_saved_tracks">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_users_saved_tracks</span><span class="p">(</span><span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">ignore_market</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a list of the songs saved in the current Spotify user&#39;s &#39;Your Music&#39; library.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-library-read</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-users-saved-tracks</span>

<span class="sd">    :param limit: The maximum number of items to return. If `limit=None` **all** Saved Tracks get returned. Default: 20. Minimum: 1.</span>
<span class="sd">    :param ignore_market: Whether to ignore market.</span>
<span class="sd">    :return: Dict containing Saved Spotify Tracks, in the form of {track_uri: track}</span>
<span class="sd">    :raises LimitException: if limit is invalid</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">check_limits</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">LimitException</span><span class="p">(</span><span class="n">invalid_limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ignore_market</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">ignore_market</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="n">tracks</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Get first (up to) 50 artists</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/tracks?</span><span class="si">{</span><span class="sa">f</span><span class="s2">&quot;market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ignore_market</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2">limit=</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="p">)</span><span class="si">}</span><span class="s2">&amp;offset=0&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">][</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
    <span class="n">tracks</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="c1"># If there are more than 50 albums:</span>
    <span class="n">total_tracks</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">current_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">total_tracks</span><span class="p">,</span> <span class="n">limit</span><span class="p">),</span> <span class="mi">50</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/tracks?market=</span><span class="si">{</span><span class="n">MARKET</span><span class="si">}</span><span class="s2">&amp;limit=50&amp;offset=</span><span class="si">{</span><span class="n">current_offset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
        <span class="n">tracks</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tracks</span></div>



<div class="viewcode-block" id="check_users_saved_tracks">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.check_users_saved_tracks">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">check_users_saved_tracks</span><span class="p">(</span><span class="n">track_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if one or more tracks is already saved in the current Spotify user&#39;s &#39;Your Music&#39; library.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-library-read</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/check-users-saved-tracks</span>

<span class="sd">    :param track_ids: A list of the Spotify IDs to be checked.</span>
<span class="sd">    :return: Dict containing Saved Spotify Tracks, in the form of {track_uri: bool}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_ids</span><span class="p">(</span><span class="n">spotify_ids</span><span class="o">=</span><span class="n">track_ids</span><span class="p">):</span>
        <span class="n">invalid_tracks</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_invalid_spotify_ids</span><span class="p">(</span><span class="n">spotify_ids</span><span class="o">=</span><span class="n">track_ids</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">invalid_tracks</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;track&quot;</span><span class="p">)</span>

    <span class="n">tracks</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">current_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">track_ids</span><span class="p">),</span> <span class="mi">50</span><span class="p">):</span>
        <span class="n">encoded_chunk</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">track_ids</span><span class="p">[</span><span class="n">current_offset</span><span class="p">:</span> <span class="n">current_offset</span> <span class="o">+</span> <span class="mi">50</span><span class="p">]))</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/tracks/contains?ids=</span><span class="si">{</span><span class="n">encoded_chunk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">_id</span><span class="p">,</span> <span class="n">existence</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">track_ids</span><span class="p">[</span><span class="n">current_offset</span><span class="p">:</span> <span class="n">current_offset</span> <span class="o">+</span> <span class="mi">50</span><span class="p">],</span> <span class="n">response</span><span class="p">):</span>
            <span class="n">tracks</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;spotify:track:</span><span class="si">{</span><span class="n">_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">existence</span>

    <span class="k">return</span> <span class="n">tracks</span></div>



<div class="viewcode-block" id="get_tracks_audio_features">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_tracks_audio_features">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_tracks_audio_features</span><span class="p">(</span><span class="n">track_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get audio feature information for a single track identified by its unique Spotify ID.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-audio-features</span>

<span class="sd">    :param track_id: The Spotify ID for the track.</span>
<span class="sd">    :return: Dict containing Audio Features, in the form of {track_uri: audio_features}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">track_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">track_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;track&quot;</span><span class="p">)</span>

    <span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;EXTENDED_TOKEN&quot;</span><span class="p">))[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/audio-features/</span><span class="si">{</span><span class="n">track_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">overwrite_header</span><span class="o">=</span><span class="n">header</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">response</span><span class="p">}</span></div>



<div class="viewcode-block" id="get_several_tracks_audio_features">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_several_tracks_audio_features">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_several_tracks_audio_features</span><span class="p">(</span><span class="n">track_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get audio features for multiple tracks based on their Spotify IDs.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-several-audio-features</span>

<span class="sd">    :param track_ids: A comma-separated list of the Spotify IDs for the tracks.</span>
<span class="sd">    :return: Dict containing Audio Features, in the form of {track_uri: audio_features}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_ids</span><span class="p">(</span><span class="n">spotify_ids</span><span class="o">=</span><span class="n">track_ids</span><span class="p">):</span>
        <span class="n">invalid_tracks</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_invalid_spotify_ids</span><span class="p">(</span><span class="n">spotify_ids</span><span class="o">=</span><span class="n">track_ids</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">invalid_tracks</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;track&quot;</span><span class="p">)</span>

    <span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;EXTENDED_TOKEN&quot;</span><span class="p">))[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]}</span>
    <span class="n">audio_features</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">current_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">track_ids</span><span class="p">),</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">encoded_chunk</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">track_ids</span><span class="p">[</span><span class="n">current_offset</span><span class="p">:</span> <span class="n">current_offset</span> <span class="o">+</span> <span class="mi">100</span><span class="p">]))</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/audio-features?ids=</span><span class="si">{</span><span class="n">encoded_chunk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">overwrite_header</span><span class="o">=</span><span class="n">header</span>
        <span class="p">)</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;audio_features&quot;</span><span class="p">]}</span>
        <span class="n">audio_features</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">audio_features</span></div>



<div class="viewcode-block" id="get_original_tracks">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_original_tracks">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_original_tracks</span><span class="p">(</span><span class="n">tracks</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If the track has been relinked, the response contains a linked_from object containing information about the original</span>
<span class="sd">    track. In the example above, the track that was requested had the Spotify URI spotify:track:6kLCHFM39wkFjOuyPGLGeQ.</span>
<span class="sd">    Since it’s been relinked, this original track URI can be found in the linked_from object. The parent track object</span>
<span class="sd">    now contains metadata about the relinked track with URI spotify:track:6ozxplTAjWO0BlUxN8ia0A.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/concepts/track-relinking</span>

<span class="sd">    :param tracks: Dict containing Spotify Tracks, in the form of {track_uri: track}</span>
<span class="sd">    :return: Dict containing original Spotify Tracks, in the form of {track_uri: track}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tracks</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">tracks</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="s2">&quot;{&#39;spotify:track:$</span><span class="si">{track_id}</span><span class="s2">&#39;: {...}, ..., &#39;spotify:track:$</span><span class="si">{track_id}</span><span class="s2">&#39;: {...}}&quot;</span><span class="p">,</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="n">original_tracks</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">current_track_uri</span><span class="p">,</span> <span class="n">current_track</span> <span class="ow">in</span> <span class="n">tracks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_track</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">current_track</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="s2">&quot;{&#39;spotify:track:$</span><span class="si">{track_id}</span><span class="s2">&#39;: {...}}&quot;</span><span class="p">,</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">current_track</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;linked_from&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">original_track_id</span> <span class="o">=</span> <span class="n">current_track</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;linked_from&quot;</span><span class="p">)[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="n">original_track</span> <span class="o">=</span> <span class="n">get_track</span><span class="p">(</span><span class="n">track_id</span><span class="o">=</span><span class="n">original_track_id</span><span class="p">,</span> <span class="n">ignore_market</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">original_tracks</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">original_track</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">original_tracks</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">current_track_uri</span><span class="p">:</span> <span class="n">current_track</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">original_tracks</span></div>



<span class="c1"># &lt;-- Begin Spotify User Methods --&gt;</span>
<div class="viewcode-block" id="get_current_users_profile">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_current_users_profile">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_current_users_profile</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get detailed profile information about the current user (including the current user&#39;s username).</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-read-private, user-read-email</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-current-users-profile</span>

<span class="sd">    :return: Dict containing Spotify Users, in the form of {user_uri: user}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">response</span><span class="p">}</span></div>



<div class="viewcode-block" id="get_users_top_items">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_users_top_items">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_users_top_items</span><span class="p">(</span>
        <span class="n">item_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;artists&quot;</span><span class="p">,</span> <span class="s2">&quot;tracks&quot;</span><span class="p">],</span>
        <span class="n">time_range</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;short_term&quot;</span><span class="p">,</span> <span class="s2">&quot;medium_term&quot;</span><span class="p">,</span> <span class="s2">&quot;long_term&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;medium_term&quot;</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the current user&#39;s top artists or tracks based on calculated affinity.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-top-read</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-users-top-artists-and-tracks</span>

<span class="sd">    :param item_type: The type of entity to return. Valid values: &quot;artists&quot; or &quot;tracks&quot;</span>
<span class="sd">    :param time_range: Over what time frame the affinities are computed. Valid values: &quot;long_term&quot; (calculated from ~1 year of data and including all new data as it becomes available), &quot;medium_term&quot; (approximately last 6 months), &quot;short_term&quot; (approximately last 4 weeks). Default: medium_term</span>
<span class="sd">    :param limit: The maximum number of items to return. If `limit=None` **all** Top Tracks get returned. Default: 20. Minimum: 1.</span>
<span class="sd">    :return: Dict containing Spotify Tracks, in the form of {user_uri: user}</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    :raises LimitException: if limit is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;artists&quot;</span><span class="p">,</span> <span class="s2">&quot;tracks&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">item_type</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;artists&quot;</span><span class="p">,</span> <span class="s2">&quot;tracks&quot;</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_range</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">time_range</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;short_term&quot;</span><span class="p">,</span> <span class="s2">&quot;medium_term&quot;</span><span class="p">,</span> <span class="s2">&quot;long_term&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">time_range</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;short_term&quot;</span><span class="p">,</span> <span class="s2">&quot;medium_term&quot;</span><span class="p">,</span> <span class="s2">&quot;long_term&quot;</span><span class="p">),</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">check_limits</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">LimitException</span><span class="p">(</span><span class="n">invalid_limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>

    <span class="n">tracks</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Get first (up to) 50 artists</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/top/</span><span class="si">{</span><span class="n">item_type</span><span class="si">}</span><span class="s2">?time_range=</span><span class="si">{</span><span class="n">time_range</span><span class="si">}</span><span class="s2">&amp;limit=</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="p">)</span><span class="si">}</span><span class="s2">&amp;offset=0&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
    <span class="n">tracks</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="c1"># If there are more than 50 albums:</span>
    <span class="n">total_artists</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">current_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">total_artists</span><span class="p">,</span> <span class="n">limit</span><span class="p">),</span> <span class="mi">50</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/top/</span><span class="si">{</span><span class="n">item_type</span><span class="si">}</span><span class="s2">?time_range=</span><span class="si">{</span><span class="n">time_range</span><span class="si">}</span><span class="s2">&amp;limit=50&amp;offset=</span><span class="si">{</span><span class="n">current_offset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
        <span class="n">tracks</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tracks</span></div>



<div class="viewcode-block" id="get_users_profile">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_users_profile">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_users_profile</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get public profile information about a Spotify user.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-users-profile</span>

<span class="sd">    :param user_id: The user&#39;s Spotify user ID.</span>
<span class="sd">    :return: Dict containing Spotify Users, in the form of {user_uri: user}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_id</span><span class="p">(</span><span class="n">spotify_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">is_user</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/users/</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">response</span><span class="p">}</span></div>



<div class="viewcode-block" id="get_several_users">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_several_users">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_several_users</span><span class="p">(</span><span class="n">user_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Spotify catalog information for multiple user based on their Spotify IDs.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** None</span>

<span class="sd">    :param user_ids: A list of the Spotify IDs to be checked.</span>
<span class="sd">    :return: Dict containing Spotify User, in the form of {user_uri: user}</span>
<span class="sd">    :raises SpotifyIdException: if spotify id is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_spotify_user_ids</span><span class="p">(</span><span class="n">spotify_ids</span><span class="o">=</span><span class="n">user_ids</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SpotifyIdException</span><span class="p">(</span><span class="n">invalid_id</span><span class="o">=</span><span class="n">user_ids</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">)</span>

    <span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Warning: Does not use API optimization, because there is no Web API method for this by Spotify</span>
    <span class="c1">#   If HTTP Error 429 occurs multiple times set time.sleep(X) between the iterations</span>
    <span class="k">for</span> <span class="n">current_user_id</span> <span class="ow">in</span> <span class="n">user_ids</span><span class="p">:</span>
        <span class="n">current_playlist</span> <span class="o">=</span> <span class="n">get_users_profile</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">current_user_id</span><span class="p">)</span>
        <span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">current_playlist</span><span class="p">)</span>
        <span class="c1"># time.sleep(X)</span>

    <span class="k">return</span> <span class="n">users</span></div>



<div class="viewcode-block" id="get_followed_artists">
<a class="viewcode-back" href="../../code_backend.html#code_backend.spotify_web_api.get_followed_artists">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_followed_artists</span><span class="p">(</span><span class="n">get_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;artist&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the current user&#39;s followed artists.</span>
<span class="sd">    </span>
<span class="sd">    **Needed Scopes:** user-follow-read</span>
<span class="sd">    </span>
<span class="sd">    **Official API Documentation:** https://developer.spotify.com/documentation/web-api/reference/get-followed</span>

<span class="sd">    :param get_type: The ID type: currently only artist is supported.</span>
<span class="sd">    :return: Dict containing Spotify Artists, in the form of {artist_uri: artist}</span>
<span class="sd">    :raises InputException: if input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">get_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">get_type</span> <span class="o">!=</span> <span class="s2">&quot;artist&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InputException</span><span class="p">(</span><span class="n">item_value</span><span class="o">=</span><span class="n">get_type</span><span class="p">,</span> <span class="n">valid_values</span><span class="o">=</span><span class="s2">&quot;artist&quot;</span><span class="p">,</span> <span class="n">valid_types</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="n">artists</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Get first (up to) 50 artists</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/following?type=</span><span class="si">{</span><span class="n">get_type</span><span class="si">}</span><span class="s2">&amp;limit=50&quot;</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;artists&quot;</span><span class="p">][</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
    <span class="n">artists</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="c1"># If there are more than 50 albums:</span>
    <span class="n">total_artists</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;artists&quot;</span><span class="p">][</span><span class="s2">&quot;total&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">current_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">total_artists</span><span class="p">,</span> <span class="mi">50</span><span class="p">):</span>
        <span class="n">last_id</span> <span class="o">=</span> <span class="n">artists</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">artists</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">api_request_data</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/me/following?type=</span><span class="si">{</span><span class="n">get_type</span><span class="si">}</span><span class="s2">&amp;limit=50&amp;after=</span><span class="si">{</span><span class="n">last_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">json_data</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;uri&quot;</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;artists&quot;</span><span class="p">][</span><span class="s2">&quot;items&quot;</span><span class="p">]}</span>
        <span class="n">artists</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">artists</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
    <span class="c1"># print(api_request_data(</span>
    <span class="c1">#     url=f&quot;https://api.spotify.com/v1/albums/79fnwKynD56xIXBVWkyaE5?market={MARKET}&quot;,</span>
    <span class="c1">#     request_type=&quot;GET&quot;,</span>
    <span class="c1">#     json_data=None</span>
    <span class="c1"># ))</span>

    <span class="c1"># with open(absolute_path(&quot;code_backend/testing/debugging.json&quot;), &quot;r&quot;) as jile:</span>
    <span class="c1">#     relinked_track = json.load(jile)</span>
    <span class="c1">#</span>
    <span class="c1"># print(get_original_tracks(relinked_track))</span>


    <span class="c1"># playlist_tracks = get_playlist_items(playlist_id=&quot;6bRkO7PLCXgmV4EJH52iU4&quot;)</span>
    <span class="c1">#</span>
    <span class="c1"># json_to_file(</span>
    <span class="c1">#     json_filepath=absolute_path(&quot;code_backend/testing/debugging.json&quot;),</span>
    <span class="c1">#     json_data=playlist_tracks,</span>
    <span class="c1">#     overwrite=True</span>
    <span class="c1"># )</span>
    <span class="c1"># json_to_file(</span>
    <span class="c1">#     json_filepath=absolute_path(&quot;code_backend/testing/debugging_2.json&quot;),</span>
    <span class="c1">#     json_data=get_original_tracks(tracks=playlist_tracks),</span>
    <span class="c1">#     overwrite=True</span>
    <span class="c1"># )</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Atomdonat.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>